language: cpp

os: linux
sudo: required
dist: trusty

compiler:
    - gcc

addons:
    apt:
        sources:
            - deadsnakes
            - ubuntu-toolchain-r-test
        packages:
            - gcc-4.9
            - g++-4.9
            - python3.5
            - python3.5-dev
            - mesa-common-dev
            - libglu1-mesa-dev

before_install:
    - sudo add-apt-repository -y ppa:beineri/opt-qt56-trusty
    - sudo apt-get -qq update

install:
    - sudo apt-get install -y qt-latest
    - sudo apt-get install -y qtcreator-latest

before_script:
    - export PATH=/opt/qt56/bin:$PATH
    - bash /opt/qt56/bin/qt56-env.sh
    - qbs setup-toolchains --detect
    - qbs setup-qt /opt/qt56/bin/qmake qt56
    - qbs config defaultProfile qt56

script:
    - qbs clean --all-artifacts -d ../build-stoiridh-controls
    - qbs build -d ../build-stoiridh-controls StoiridhUtils.Project.productName:StoiridhControls
    - qbs install -d ../build-stoiridh-controls
    # TODO Merge the following autotests with the command below when a new version of Stoiridh Qbs
    #      Configuration (1.1.0) shall release.
    # - qbs run -p "autotest-runner" -d ../build-stoiridh-controls

    # Stoiridh.Controls.Templates autotests
    - qbs run -p "[Core] Exception Autotest" -d ../build-stoiridh-controls
    - qbs run -p "[Core] ExceptionHandler Autotest" -d ../build-stoiridh-controls
    - qbs run -p "[Core] NullPointerException Autotest" -d ../build-stoiridh-controls
    - qbs run -p "[Stoiridh.Controls.Templates] Control Autotest" -d ../build-stoiridh-controls
    - qbs run -p "[Stoiridh.Controls.Templates] Padding Autotest" -d ../build-stoiridh-controls
    # Stoiridh.Controls.Templates autotests (internal)
    - qbs run -p "[Internal] AbstractStyleDispatcher Autotest" -d ../build-stoiridh-controls
    # - qbs run -p "[Internal] Style Autotest" -d ../build-stoiridh-controls
    # - qbs run -p "[Internal] StyleDispatcher Autotest" -d ../build-stoiridh-controls
    # - qbs run -p "[Internal] StyleFactory Autotest" -d ../build-stoiridh-controls
    # - qbs run -p "[Internal] StyleFactoryHelper Autotest" -d ../build-stoiridh-controls
    - qbs run -p "[Internal] StylePropertyChanges Autotest" -d ../build-stoiridh-controls
    - qbs run -p "[Internal] StylePropertyExpression Autotest" -d ../build-stoiridh-controls
    # - qbs run -p "[Internal] StyleState Autotest" -d ../build-stoiridh-controls
    - qbs run -p "[Internal] StyleStateController Autotest" -d ../build-stoiridh-controls
    - qbs run -p "[Internal] StyleStateOperation Autotest" -d ../build-stoiridh-controls
